<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generating the Observation Period Table • OmopConstructor</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generating the Observation Period Table">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OmopConstructor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/generateObservationPeriod.html">Generating the Observation Period Table</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/OmopConstructor/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generating the Observation Period Table</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/OmopConstructor/blob/main/vignettes/generateObservationPeriod.Rmd" class="external-link"><code>vignettes/generateObservationPeriod.Rmd</code></a></small>
      <div class="d-none name"><code>generateObservationPeriod.Rmd</code></div>
    </div>

    
    
<pre><code><span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> `EUNOMIA_DATA_FOLDER` set to: <span style="color: #0000BB;">/tmp/Rtmpe6Z6Tu</span>.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Download completed!</span></span></code></pre>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://OHDSI.io/OmopConstructor/" class="external-link">OmopConstructor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/DrugUtilisation/" class="external-link">DrugUtilisation</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/IncidencePrevalence/" class="external-link">IncidencePrevalence</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CodelistGenerator/" class="external-link">CodelistGenerator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Connect to Eunomia database</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/eunomiaDir.html" class="external-link">eunomiaDir</a></span><span class="op">(</span>datasetName <span class="op">=</span> <span class="st">"synthea-covid19-200k"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Downloading synthea-covid19-200k</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Download completed!</span></span>
<span><span class="co">#&gt; Creating CDM database /tmp/Rtmpe6Z6Tu/synthea-covid19-200k_5.3.zip</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">■■■■                            </span>  10% | ETA: 35s</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■            </span>  63% | ETA:  7s</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■■■         </span>  73% | ETA:  6s</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■■■■■       </span>  80% | ETA:  5s</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">cdmFromCon</a></span><span class="op">(</span></span>
<span>  con <span class="op">=</span> <span class="va">con</span>, cdmSchema <span class="op">=</span> <span class="st">"main"</span>, writeSchema <span class="op">=</span> <span class="st">"main"</span>, cdmName <span class="op">=</span> <span class="st">"Eunomia"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">codelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getDrugIngredientCodes.html" class="external-link">getDrugIngredientCodes</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"acetaminophen"</span><span class="op">)</span>,</span>
<span>  nameStyle <span class="op">=</span> <span class="st">"{concept_name}"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/DrugUtilisation/reference/generateDrugUtilisationCohortSet.html" class="external-link">generateDrugUtilisationCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>, conceptSet <span class="op">=</span> <span class="va">codelist</span>, name <span class="op">=</span> <span class="st">"outcome"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Subsetting <span style="color: #0000BB;">drug_exposure</span> table</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Checking whether any record needs to be dropped.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Collapsing overlaping records.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Collapsing records with gapEra = 1 days.</span></span>
<span></span>
<span><span class="va">cdm</span> </span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (duckdb) of Eunomia</span> <span style="color: #00BBBB;">────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">omop tables:</span> attribute_definition, care_site, cdm_source, cohort_definition,</span></span>
<span><span class="co">#&gt; concept, concept_ancestor, concept_class, concept_relationship,</span></span>
<span><span class="co">#&gt; concept_synonym, condition_era, condition_occurrence, cost, death,</span></span>
<span><span class="co">#&gt; device_exposure, domain, dose_era, drug_era, drug_exposure, drug_strength,</span></span>
<span><span class="co">#&gt; fact_relationship, location, measurement, metadata, note, note_nlp,</span></span>
<span><span class="co">#&gt; observation, observation_period, payer_plan_period, person,</span></span>
<span><span class="co">#&gt; procedure_occurrence, provider, relationship, source_to_concept_map, specimen,</span></span>
<span><span class="co">#&gt; visit_detail, visit_occurrence, vocabulary</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">cohort tables:</span> outcome</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other tables:</span> -</span></span></code></pre></div>
<div class="section level2">
<h2 id="first-record-to-end-of-database">First record to end of database<a class="anchor" aria-label="anchor" href="#first-record-to-end-of-database"></a>
</h2>
<p>The default settings for <code><a href="../reference/generateObservationPeriod.html">generateObservationPeriod()</a></code> is
from first record to end of database. This means that each individual
has one observation period, that spans from when they first enter the
database up to the end of the data. This setting results in the longest
observation period. it is not advised to use this in a database where
deaths or other exits from the database aren’t well recorded.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateObservationPeriod.html">generateObservationPeriod</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span>,</span>
<span>  collapseEra <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  persistenceWindow <span class="op">=</span> <span class="cn">Inf</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/plotObservationPeriod.html" class="external-link">plotObservationPeriod</a></span><span class="op">(</span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.html" class="external-link">summariseObservationPeriod</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span><span class="op">)</span>, </span>
<span>                                  plotType <span class="op">=</span> <span class="st">"densityplot"</span>,</span>
<span>                                  variableName <span class="op">=</span> <span class="st">"Duration in days"</span><span class="op">)</span></span></code></pre></div>
<p><img src="generateObservationPeriod_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="min-to-max-observation-period">Min to Max Observation Period<a class="anchor" aria-label="anchor" href="#min-to-max-observation-period"></a>
</h2>
<p>Another option is for an observation period to span from the first
record to the last record observed for each person.</p>
<p>This option can cause problems towards the end of the database.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateObservationPeriod.html">generateObservationPeriod</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span>,</span>
<span>  collapseEra <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  persistenceWindow <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/plotObservationPeriod.html" class="external-link">plotObservationPeriod</a></span><span class="op">(</span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.html" class="external-link">summariseObservationPeriod</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span><span class="op">)</span>, </span>
<span>                                  plotType <span class="op">=</span> <span class="st">"densityplot"</span>,</span>
<span>                                  variableName <span class="op">=</span> <span class="st">"Duration in days"</span><span class="op">)</span></span></code></pre></div>
<p><img src="generateObservationPeriod_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="under-observation-during-visits-only">Under observation during visits only<a class="anchor" aria-label="anchor" href="#under-observation-during-visits-only"></a>
</h2>
<p>Another option is to have people only be under observation during
primary care or hospital visits. This would result in most people having
multiple observation periods, with each period duration being relatively
short.</p>
<p>This is not a good option to use if you want to calculate incidence
or prevalence, as it will result in an unreliable denominator.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateObservationPeriod.html">generateObservationPeriod</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span>,</span>
<span>  collapseEra <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  persistenceWindow <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  recordsFrom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visit_occurrence"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/plotObservationPeriod.html" class="external-link">plotObservationPeriod</a></span><span class="op">(</span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.html" class="external-link">summariseObservationPeriod</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>observation_period_order <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span> <span class="op">==</span> <span class="st">"all"</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                observation_period_ordinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>                  <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span>,</span>
<span>                  levels <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">observation_period_order</span><span class="op">)</span><span class="op">]</span></span>
<span>                <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="generateObservationPeriod_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="censor-after-180-days-of-no-records">Censor after 180 days of no records<a class="anchor" aria-label="anchor" href="#censor-after-180-days-of-no-records"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateObservationPeriod.html">generateObservationPeriod</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span>,</span>
<span>  collapseEra <span class="op">=</span> <span class="fl">180</span>,</span>
<span>  persistenceWindow <span class="op">=</span> <span class="fl">180</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/plotObservationPeriod.html" class="external-link">plotObservationPeriod</a></span><span class="op">(</span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.html" class="external-link">summariseObservationPeriod</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>observation_period_order <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span> <span class="op">==</span> <span class="st">"all"</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                observation_period_ordinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>                  <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span>,</span>
<span>                  levels <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">observation_period_order</span><span class="op">)</span><span class="op">]</span></span>
<span>                <span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="censor-after-365-days-of-no-records">Censor after 365 days of no records<a class="anchor" aria-label="anchor" href="#censor-after-365-days-of-no-records"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateObservationPeriod.html">generateObservationPeriod</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span>,</span>
<span>  collapseEra <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  persistenceWindow <span class="op">=</span> <span class="fl">365</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/plotObservationPeriod.html" class="external-link">plotObservationPeriod</a></span><span class="op">(</span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.html" class="external-link">summariseObservationPeriod</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>observation_period_order <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span> <span class="op">==</span> <span class="st">"all"</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                observation_period_ordinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>                  <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span>,</span>
<span>                  levels <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">observation_period_order</span><span class="op">)</span><span class="op">]</span></span>
<span>                <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="generateObservationPeriod_files/figure-html/unnamed-chunk-7-1.png" width="700">
## Censor after 545 days of no records</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateObservationPeriod.html">generateObservationPeriod</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span>,</span>
<span>  collapseEra <span class="op">=</span> <span class="fl">545</span>,</span>
<span>  persistenceWindow <span class="op">=</span> <span class="fl">545</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/plotObservationPeriod.html" class="external-link">plotObservationPeriod</a></span><span class="op">(</span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.html" class="external-link">summariseObservationPeriod</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>observation_period_order <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span> <span class="op">==</span> <span class="st">"all"</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                observation_period_ordinal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>                  <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span>,</span>
<span>                  levels <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">observation_period_ordinal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">observation_period_order</span><span class="op">)</span><span class="op">]</span></span>
<span>                <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="generateObservationPeriod_files/figure-html/unnamed-chunk-8-1.png" width="700">
## Paediatric Databases</p>
<p>The function <code><a href="../reference/generateObservationPeriod.html">generateObservationPeriod()</a></code> contains an
argument called <code>censorAge</code>, which allows users to define the
age at which a patient is no longer in observation. For example, for
paediatric databases you would not expect patients to be under
observation once they turn 18.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateObservationPeriod.html">generateObservationPeriod</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span>,</span>
<span>  collapseEra <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  persistenceWindow <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  censorAge <span class="op">=</span> <span class="fl">18L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/plotObservationPeriod.html" class="external-link">plotObservationPeriod</a></span><span class="op">(</span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.html" class="external-link">summariseObservationPeriod</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="generateObservationPeriod_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/plotObservationPeriod.html" class="external-link">plotObservationPeriod</a></span><span class="op">(</span><span class="fu">OmopSketch</span><span class="fu">::</span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.html" class="external-link">summariseObservationPeriod</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span><span class="op">)</span>, </span>
<span>                                  plotType <span class="op">=</span> <span class="st">"densityplot"</span>,</span>
<span>                                  variableName <span class="op">=</span> <span class="st">"Duration in days"</span><span class="op">)</span></span></code></pre></div>
<p><img src="generateObservationPeriod_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martí Català.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
